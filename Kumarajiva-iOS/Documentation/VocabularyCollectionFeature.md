# 生词收藏功能实现文档

## 功能概述

在"练听力" -> "生词解析" -> "生词列表"中增加了生词收藏功能，用户可以将播客中的生词添加到"记单词" -> "生词库"中。

## 实现细节

### 1. 数据模型更新

#### VocabularyItem 结构体
- 添加了 `isNewlyAdded: Bool?` 字段，用于标记新添加的生词
- 位置：`Kumarajiva-iOS/Services/APIService.swift`

```swift
struct VocabularyItem: Codable, Identifiable {
    // ... 其他字段
    let isNewlyAdded: Bool?  // 标记是否是新添加的生词
}
```

#### VocabularyImportItem 结构体
- 同样添加了 `isNewlyAdded: Bool?` 字段
- 用于导入生词时标记新添加的状态

### 2. UI 组件更新

#### VocabularyCardView（生词解析页面）
- 位置：`Kumarajiva-iOS/Views/VocabularyAnalysisView.swift`
- 添加了收藏按钮，显示在每个生词卡片的右侧
- 状态管理：
  - `isCollected`: 表示该生词是否已在生词库中
  - `isLoading`: 收藏操作进行中的加载状态
- 功能：
  - 页面加载时自动检查生词是否已存在于生词库
  - 点击收藏按钮将生词添加到生词库
  - 已收藏的生词显示填充的星形图标（黄色）
  - 未收藏的生词显示空心星形图标（灰色）

#### VocabularyView（生词库页面）
- 位置：`Kumarajiva-iOS/Views/VocabularyView.swift`
- 新增筛选选项：
  - "全部"
  - "已掌握"
  - "未掌握"
  - "新添加"（新增）
- VocabularyCard 组件中添加了"新添加"标记
  - 使用紫色 sparkles 图标标识
  - 显示在单词名称旁边

### 3. 功能特性

1. **收藏状态检查**
   - 进入生词解析页面时，自动检查每个生词是否已在生词库中
   - 已存在的生词显示"已收藏"状态

2. **一键收藏**
   - 点击收藏按钮即可将生词添加到生词库
   - 添加时会包含：
     - 单词
     - 词性和释义
     - 音标
     - 时间戳
     - 新添加标记

3. **筛选功能**
   - 在生词库中可以按"新添加"状态筛选
   - 方便用户查看最近从播客中收藏的生词

4. **云端同步**
   - 收藏的生词会通过 API 同步到云端
   - 确保数据在多设备间保持一致

### 4. API 集成

使用现有的 `importVocabularies` API 方法将生词添加到生词库：
- 端点：`/vocab/import`
- 方法：POST
- 数据格式：包含 `isNewlyAdded` 标记的 VocabularyImportItem

### 5. 用户体验优化

1. **视觉反馈**
   - 收藏按钮有明确的状态变化
   - 加载时显示进度指示器
   - 新添加的生词有特殊标记

2. **操作便捷**
   - 一键收藏，无需额外确认
   - 收藏后自动刷新生词库

3. **数据一致性**
   - 收藏状态实时更新
   - 支持离线缓存和在线同步

## 使用流程

1. 用户在"练听力"功能中生成字幕
2. 点击"生词解析"分析字幕中的难词
3. 在生词列表中，未收藏的生词显示空心星标
4. 点击星标收藏生词到生词库
5. 收藏成功后，星标变为填充状态
6. 在"记单词" -> "生词库"中可以看到新添加的生词
7. 可以通过"新添加"筛选查看最近收藏的生词

## 技术亮点

1. **状态管理**：使用 SwiftUI 的 @State 和 @StateObject 管理组件状态
2. **异步操作**：使用 async/await 处理网络请求
3. **缓存机制**：利用 VocabularyViewModel 的缓存减少网络请求
4. **响应式UI**：状态变化自动触发 UI 更新 